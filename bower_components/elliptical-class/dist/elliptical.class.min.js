!function(t,e){"undefined"!=typeof module&&module.exports?module.exports=e(require("elliptical-utils")):"function"==typeof define&&define.amd?define(["elliptical-utils"],e):(t.elliptical.Class=e(t.elliptical.utils),t.returnExports=t.elliptical.Class)}(this,function(t){var e=(t._,!1),n=t.array.makeArray,r=t.object.isFunction,s=Array.isArray,a=t.object.extend,i=t.array.concatArgs,u=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/,l=function(t,e,n){n=n||t;for(var s in t)n[s]=r(t[s])&&r(e[s])&&u.test(t[s])?function(t,n){return function(){var r,s=this._super;return this._super=e[t],r=n.apply(this,arguments),this._super=s,r}}(s,t[s]):t[s]},o=function(){arguments.length&&o.extend.apply(o,arguments)};return a(o,{proxy:function(t){var e,a=n(arguments);t=a.shift(),s(t)||(t=[t]),e=this;for(var u=0;u<t.length;u++)if("string"==typeof t[u]&&!r(this[t[u]]))throw"class.js "+(this.fullName||this.Class.fullName)+" does not have a "+t[u]+"method!";return function(){for(var n,r,u=i(a,arguments),l=t.length,o=0;l>o;o++)r=t[o],r&&(n="string"==typeof r,n&&e._set_called&&(e.called=r),u=(n?e[r]:r).apply(e,u||[]),l-1>o&&(u=!s(u)||u._use_call?[u]:u));return u}},newInstance:function(){var t,e=this.rawInstance();return e.setup&&(t=e.setup.apply(e,arguments)),e.init&&e.init.apply(e,s(t)?t:arguments),e},setup:function(t,e){return this.defaults=a(!0,{},t.defaults,this.defaults),arguments},rawInstance:function(){e=!0;var t=new this;return e=!1,t},extend:function(n,r){function s(){return e?void 0:this.constructor!==s&&arguments.length?arguments.callee.extend.apply(arguments.callee,arguments):this.Class.newInstance.apply(this.Class,arguments)}r||(r=n,n=null),r=r||{};var i,u=this,o=this.prototype;e=!0,i=new this,e=!1,l(r,o,i);for(name in this)this.hasOwnProperty(name)&&-1==["prototype","defaults"].indexOf(name)&&(s[name]=this[name]);l(n,this,s),a(s,{prototype:i,constructor:s}),s.prototype.Class=s.prototype.constructor=s;var p=s.setup.apply(s,t.concatArgs([u],arguments));return s.init&&s.init.apply(s,p||[]),s}}),o.callback=o.prototype.callback=o.prototype.proxy=o.proxy,o});